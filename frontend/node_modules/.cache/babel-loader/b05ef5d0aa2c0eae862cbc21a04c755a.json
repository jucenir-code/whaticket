{"ast":null,"code":"import React,{useEffect,useState,useContext}from'react';import{useHistory}from\"react-router-dom\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";import Avatar from\"@material-ui/core/Avatar\";import Typography from\"@material-ui/core/Typography\";import Grid from\"@material-ui/core/Grid\";import Modal from\"@material-ui/core/Modal\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{Button,Divider}from\"@material-ui/core\";import NewTicketModal from\"../NewTicketModal\";const VCardPreview=_ref=>{let{contact,numbers}=_ref;const history=useHistory();const{user}=useContext(AuthContext);const[selectedContact,setContact]=useState({name:\"\",number:0,profilePicUrl:\"\"});const[selectedQueue,setSelectedQueue]=useState(\"\");const[isModalOpen,setModalOpen]=useState(false);const[isContactValid,setContactValid]=useState(true);const[newTicketModalOpen,setNewTicketModalOpen]=useState(false);const[contactTicket,setContactTicket]=useState({});const handleQueueSelection=async queueId=>{setSelectedQueue(queueId);setModalOpen(false);if(queueId!==\"\"){await createTicket(queueId);}};const renderQueueModal=()=>{return/*#__PURE__*/React.createElement(Modal,{open:isModalOpen,onClose:()=>setModalOpen(false)},/*#__PURE__*/React.createElement(\"div\",{style:{position:\"absolute\",top:\"50%\",left:\"50%\",transform:\"translate(-50%, -50%)\",backgroundColor:\"#FFF\",padding:\"20px\",outline:\"none\"}},/*#__PURE__*/React.createElement(\"h2\",null,\"Selecione a Fila\"),user.queues.map(queue=>/*#__PURE__*/React.createElement(\"div\",{key:queue.id},/*#__PURE__*/React.createElement(Button,{onClick:()=>handleQueueSelection(queue.id)},queue.name)))));};useEffect(()=>{const fetchContacts=async()=>{try{let contactObj={name:contact,number:numbers.replace(/\\D/g,\"\"),email:\"\"};const{data}=await api.post(\"/contacts\",contactObj);if(data.alreadyExists){setContact(data.existingContact);}else{setContact(contactObj);}if(data.invalido){//console.log(\"CONTATO INVALIDOOOOO\");\n//console.log(data.error);\n// SHOULD RETURN ANOTHER VIEW\n// Update the button text and disable the button\nsetContactValid(false);}//console.log(\"XXXXXXXXXXXXXXXX\");\n//console.log(data);\n//console.log(contactObj);\n}catch(err){//console.log(err);\ntoastError(err);}};const delayDebounceFn=setTimeout(fetchContacts,1500);return()=>clearTimeout(delayDebounceFn);},[contact,numbers]);const handleNewChat=()=>{if(selectedQueue===\"\"){setModalOpen(true);}else{createTicket();}};const createTicket=async queueId=>{try{let contactId=selectedContact.id;// If selectedContact.id is null, fetch the contact ID from the server\nif(!contactId){const contactObj={name:selectedContact.name,number:selectedContact.number,email:\"\"};const{data}=await api.post(\"/contacts\",contactObj);contactId=data.existingContact.id;}//console.log(contactId);\nconst{data:ticket}=await api.post(\"/tickets\",{contactId,queueId,userId:user.id,status:\"open\"});//console.log(user);\n// console.log(selectedContact.id);\n// console.log(ticket.id);\nhistory.push(\"/tickets/\".concat(ticket.uuid));}catch(err){toastError(err);}};const handleCloseOrOpenTicket=ticket=>{setNewTicketModalOpen(false);if(ticket!==undefined&&ticket.uuid!==undefined){history.push(\"/tickets/\".concat(ticket.uuid));}};return/*#__PURE__*/React.createElement(React.Fragment,null,renderQueueModal(),/*#__PURE__*/React.createElement(\"div\",{style:{minWidth:\"250px\"}},/*#__PURE__*/React.createElement(NewTicketModal,{modalOpen:newTicketModalOpen,initialContact:selectedContact,onClose:ticket=>{handleCloseOrOpenTicket(ticket);}}),/*#__PURE__*/React.createElement(Grid,{container:true,spacing:1},/*#__PURE__*/React.createElement(Grid,{item:true,xs:1},/*#__PURE__*/React.createElement(Avatar,{src:selectedContact.profilePicUrl})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:9},/*#__PURE__*/React.createElement(Typography,{style:{marginTop:\"12px\",marginLeft:\"10px\"},variant:\"subtitle1\",color:\"primary\",gutterBottom:true},selectedContact.name)),/*#__PURE__*/React.createElement(Grid,{item:true,xs:9},/*#__PURE__*/React.createElement(Typography,{style:{marginLeft:\"10px\"},variant:\"body2\",color:\"textSecondary\",gutterBottom:true},/*#__PURE__*/React.createElement(\"strong\",null,\"Nome:\"),\" \",selectedContact.name),/*#__PURE__*/React.createElement(Typography,{style:{marginLeft:\"10px\"},variant:\"body2\",color:\"textSecondary\",gutterBottom:true},/*#__PURE__*/React.createElement(Typography,{variant:\"body2\",color:\"textSecondary\",component:\"span\"},/*#__PURE__*/React.createElement(\"strong\",null,\"Telefone:\"),\" \",selectedContact.number))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12},/*#__PURE__*/React.createElement(Divider,null),/*#__PURE__*/React.createElement(Button,{fullWidth:true,color:\"primary\",onClick:()=>{setContactTicket(selectedContact);setNewTicketModalOpen(true);},disabled:!selectedContact.number||!isContactValid},isContactValid?\"Conversar (Novo Ticket)\":\"CONTATO FORA DO WHATSAPP\")))));};export default VCardPreview;","map":null,"metadata":{},"sourceType":"module"}